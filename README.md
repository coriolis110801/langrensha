# 狼人杀推理助手

这是一个基于Django的狼人杀推理助手程序，帮助好人通过逻辑推理来识别真正的警察和匪徒。

## 功能特点

- **双假设推理**：同时假设A和B谁是真正的警察，通过约束求解找出矛盾
- **实时推理**：每次添加新事件后自动重新推理
- **概率分析**：计算每个玩家是匪徒的概率
- **智能建议**：根据推理结果给出投票建议
- **数据管理**：完整的游戏事件记录和管理

## 游戏规则

- 12个玩家：1个警察，4个匪徒，7个好人
- 警察每晚可以查验一个人的身份
- 匪徒每晚可以杀死一个人
- 白天大家讨论并投票处决可疑的匪徒
- 匪徒会伪装成警察混淆视听

## 安装和运行

1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 运行数据库迁移：
```bash
python manage.py makemigrations
python manage.py migrate
```

3. 启动开发服务器：
```bash
python manage.py runserver
```

4. 访问 http://127.0.0.1:8000

## 使用说明

### 1. 添加玩家
首先添加所有12个玩家，编号从1到12。

### 2. 记录夜晚查验
记录两个疑似警察的查验结果：
- 选择查验者（A或B）
- 选择被查验的玩家
- 记录查验结果（好人/坏人）
- 记录是第几夜的查验

### 3. 记录死亡事件
记录夜晚被杀或白天被处决的玩家：
- 选择死亡的玩家
- 选择事件类型（夜晚被杀/白天处决）
- 记录是第几夜/天

### 4. 添加主观判断
根据白天的讨论和分析，标记你认为的好人/坏人：
- 选择玩家
- 标记判断（好人/坏人）
- 记录判断理由

### 5. 查看推理结果
系统会自动：
- 比较两种假设（A是警察 vs B是警察）的可行性
- 计算每个玩家是匪徒的概率
- 给出推理建议和投票建议

## 推理逻辑

系统使用约束求解算法：

1. **约束条件**：
   - 总共有1个警察、4个匪徒、7个好人
   - 死亡的人不能是匪徒
   - 真警察的查验结果必须正确
   - 假警察的查验结果必须错误
   - 主观判断必须符合角色分配

2. **推理过程**：
   - 分别假设A和B是真正的警察
   - 应用所有约束条件求解
   - 如果某个假设无解，说明该假设错误
   - 分析可行解中每个玩家的角色概率

3. **结果分析**：
   - 如果A假设无解，则B是真正警察
   - 如果B假设无解，则A是真正警察
   - 如果都有解，需要更多信息来排除

## 技术栈

- **后端**：Django 4.2
- **推理引擎**：python-constraint
- **前端**：Bootstrap 5 + jQuery
- **数据库**：SQLite

## 文件结构

```
werewolf_game/
├── inference/                 # 推理应用
│   ├── models.py             # 数据模型
│   ├── views.py              # 视图逻辑
│   ├── forms.py              # 表单
│   ├── logic_engine.py       # 核心推理引擎
│   ├── urls.py               # URL配置
│   └── templates/            # 模板文件
├── werewolf_game/            # 项目配置
│   ├── settings.py           # Django设置
│   └── urls.py               # 主URL配置
├── manage.py                 # Django管理脚本
├── requirements.txt          # 依赖文件
└── README.md                 # 说明文档
```

## 示例场景

假设游戏进行到第2夜：

1. **夜晚查验**：
   - A查验3号，结果是好人
   - B查验7号，结果是坏人

2. **死亡事件**：
   - 第1夜：5号被杀
   - 第1天：2号被处决

3. **主观判断**：
   - 4号是坏人（通过发言判断）
   - 8号是好人（通过发言判断）

系统会分析：
- 如果A是警察：3号是好人，7号是坏人（B说谎）
- 如果B是警察：7号是坏人，3号是坏人（A说谎）

通过约束求解，系统会找出哪种假设更合理，并给出匪徒概率分析。

## 注意事项

- 确保输入的数据准确，错误的输入会影响推理结果
- 系统假设匪徒不会杀死自己的同伴
- 主观判断要基于白天的讨论和分析
- 随着游戏进行，添加更多信息可以提高推理准确性 